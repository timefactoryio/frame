<style>
	.slides {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 100%;
		height: 100%;
		overflow: hidden;
	}
	.slides img {
		max-width: 95%;
		max-height: 95%;
		object-fit: contain;
	}
</style>

<div class="slides">
	<img src="" alt="" />
	<script>
		(function () {
			const frame = pathless.frame();
			const prefix = '{{.PREFIX}}';
			const apiBase = window.apiUrl + '/' + prefix;
			const apiImgUrl = (slide) => apiBase + '/' + slide;

			let slides = [];
			let index = pathless.state()[prefix] || 0;

			async function show(i) {
				if (!slides.length) return;
				index = ((i % slides.length) + slides.length) % slides.length;
				pathless.update(prefix, index);

				const img = frame.querySelector('img');
				if (!img) return;

				const slide = slides[index];
				pathless
					.fetch(apiImgUrl(slide))
					.then(({ data }) => {
						img.src = data;
						img.alt = slide;
					})
					.catch(() => {
						img.alt = 'Failed to load image';
					});
			}

			pathless.fetch(apiBase).then(({ data }) => {
				slides = data || [];
				if (slides.length) show(index);
			});

			pathless.onKey('a', () => show(index - 1));
			pathless.onKey('d', () => show(index + 1));
		})();
	</script>
</div>
