<style>
	.keyboard {
		height: 100%;
		aspect-ratio: 4 / 2.5;
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		grid-template-rows: repeat(3, 1fr);
		gap: 0.5em;
		padding: 0.2em 0 0.5em;
		box-sizing: border-box;
	}
	.key {
		display: flex;
		flex-direction: column;
		border: medium solid #444;
		border-radius: 3px;
		overflow: hidden;
		cursor: pointer;
		user-select: none;
		padding-top: 0.3em;
		font-size: 1.2em;
		color: #aaa;
	}
	.key::before {
		content: attr(data-key);
		text-align: center;
		height: 1.5em;
	}
	.key[data-key='q'] {
		border-color: red;
	}
	.key[data-key='e'] {
		border-color: blue;
	}
	.key.pressed {
		border-color: white;
	}
	.content {
		flex: 1;
		display: flex;
		align-items: center;
		justify-content: center;
		font-size: 1.25em;
		font-weight: bold;
		padding: 0.1em;
		overflow: hidden;
		color: #fff;
	}
	.key[data-key='q'] .content,
	.key[data-key='e'] .content {
		font-size: 0.85em;
	}
	.content svg {
		max-width: 100%;
		max-height: 100%;
	}
</style>

<div class="keyboard"></div>

<script>
	if (!window.pathless.keyboard) {
		class Keyboard {
			static KEYS = '123qweasd';
			constructor(u) {
				this.u = u;
				this.els = {};
				this.build();
				this.render();
			}

			build() {
				const frag = document.createDocumentFragment();
				for (const k of Keyboard.KEYS) {
					const el = document.createElement('div');
					el.className = 'key';
					el.dataset.key = k;
					el.innerHTML = '<div class="content"></div>';
					frag.appendChild(el);
					this.els[k] = { key: el, content: el.firstChild };
				}
				document.querySelector('.keyboard').appendChild(frag);
			}

			render() {
				const { layouts, layout, keybinds } = this.u;
				for (const k of Keyboard.KEYS) {
					const { content } = this.els[k];
					const n = parseInt(k);

					if (n) {
						const l = layouts[n - 1];
						if (!l) {
							content.innerHTML = '';
							continue;
						}
						const idx =
							n === 1 || layout[0] !== n - 1
								? 0
								: (layout[1] + 1) % l.variants.length;
						content.innerHTML = l.variants[idx].svg;
					} else {
						content.textContent = keybinds.get(k)?.desc ?? '';
					}
				}
			}
			press(k) {
				this.els[k]?.key.classList.add('pressed');
			}
			release(k) {
				this.els[k]?.key.classList.remove('pressed');
			}
		}
		window.pathless.keyboard = new Keyboard(window.pathless);
	}
</script>
